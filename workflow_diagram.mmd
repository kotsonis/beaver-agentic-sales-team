graph TD
    %% Nodes
    User(["Customer Request"])
    Orch["Orchestrator Agent"]
    
    subgraph "Worker Agents"
        Inv["Inventory Manager"]
        Quote["Quoting Agent"]
        Sales["Sales Finisher"]
    end

    subgraph "Tools & Logic"
        %% The fix: Quotes added around the label below
        Map["map_items_wrapper <br/><i>(Semantic AI Mapping)</i>"]
        Check["check_stock_wrapper"]
        Restock["restock_wrapper"]
        Audit["audit_inventory_wrapper"]
        
        Hist["get_historical_quotes"]
        Calc["calculate_quote_batch"]
        
        Price["check_prices_batch"]
        Trans["finalize_transaction"]
        Report["generate_daily_report"]
    end

    subgraph "Database Layer"
        DB[("Munder Difflin DB")]
    end

    %% Flow
    User -->|Text Request + Date| Orch
    Orch -->|"1. Check Availability"| Inv
    Inv --> Map --> Check
    Check -->|"Low Stock?"| Restock
    Inv -.->|"Audit Request"| Audit
    
    Orch -->|"2. Get Pricing"| Quote
    Quote --> Hist & Calc
    
    Orch -->|"3. Record Order"| Sales
    Sales --> Price --> Trans
    Sales -.->|"Verify Cash"| Report

    %% Data Connections
    Map & Check & Restock & Audit & Hist & Trans & Report <--> DB